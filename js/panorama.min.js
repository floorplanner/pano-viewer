"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}return function(e,a,n){if(a)t(e.prototype,a);if(n)t(e,n);return e}}();function _classCallCheck(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var Panorama=function(){var t="a-entity[cubemap]";var e="[data-aframe-default-camera]";var a=".a-enter-vr";var n="data-a-enter-vr-no-webvr";var i=[];var s={scene_class:"panorama-viewer",active_class:"active",auto_start:true,auto_rotate:false,auto_rotate_speed:3,auto_rotate_direction:"left",rotation_time:null,init:null,pause_on_hover:false,cubemap_folder:"/img/",cubemap_folder_template:null,cubemap_name_map:null,cubemap_edge_length:5e3};return function(){function r(t){var e=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];_classCallCheck(this,r);this.selector=t;this.container=document.querySelector(t);this.settings({},s,e,this.inline_settings(this.container));if(this.settings.auto_start){this.init()}}_createClass(r,[{key:"settings",value:function t(e){for(var a=arguments.length,n=Array(a>1?a-1:0),i=1;i<a;i++){n[i-1]=arguments[i]}this.settings=Object.assign.apply(Object,[e].concat(n))}},{key:"init",value:function t(){this.init_scene();this.set_active(true)}},{key:"init_scene",value:function t(){var e=this;var a=document.createElement("a-scene");var n=document.createElement("a-entity");var i=this.settings.scene_class+"-scene";a.classList.add(i);n.classList.add(this.settings.scene_class+"-cube");n.setAttribute("cubemap",this.cubemap_attr());a.appendChild(n);this.container.appendChild(a);this.scene=this.container.querySelector("."+i);if(this.scene.hasLoaded){this.init_settings()}else{this.listen(this.scene,"loaded",function(){e.init_settings()})}}},{key:"init_settings",value:function i(){var s=this;this.camera=this.container.querySelector(e);this.vr_button=this.container.querySelector(a);this.cubemap=this.container.querySelector(t);if(this.vr_button.hasAttribute(n)){this.vr_button.parentNode.removeChild(this.vr_button)}if(this.settings.auto_rotate){this.start_auto_rotate()}if(this.settings.pause_on_hover){this.listen(this.scene,"mouseenter",function(){return s.toggle_auto_rotate()});this.listen(this.scene,"mouseleave",function(){return s.toggle_auto_rotate()})}if(typeof this.settings.init==="function"){this.settings.init.call(this,this.container,this.camera)}}},{key:"inline_settings",value:function t(e){var a={};var n=Object.keys(s).concat(i);Object.keys(e.attributes).forEach(function(t){name=e.attributes[t].name.replace(/-/g,"_");if(n.includes(name)){a[name]=e.attributes[t].value}else if(n.includes("cubemap_"+name)){a["cubemap_"+name]=e.attributes[t].value}});Object.keys(a).forEach(function(t){var e=a[t];if(e==="true")e=true;else if(e==="false")e=false;else if(e==="null")e=null;else if(e===""){e=true}else if(!isNaN(parseFloat(e))&&isFinite(e)){e=parseFloat(e)}a[t]=e});return a}},{key:"cubemap_attr",value:function t(){var e=this;var a=this.settings.cubemap_folder_template;var n=0;var i=[];if(a){a=a.replace(/\:([^\/]+)/g,function(t,a){if(e.settings.hasOwnProperty(a)){return e.settings[a]}n+=1})}["folder","name_map","edge_length"].forEach(function(t){var s=t.replace(/_[^_]/,function(t){return t.replace(/[_]+/,"").toUpperCase()});if(a&&n===0&&t==="folder"){i.push(s+": "+a+";")}else{i.push(s+": "+e.settings["cubemap_"+t]+";")}});return i.join(" ")}},{key:"set_active",value:function t(e){this.container.classList.toggle(this.settings.active_class,e)}},{key:"start_auto_rotate",value:function t(){if(!this.__auto_rotate_enabled){this.prev_frame_ts=performance.now();this.__auto_rotate_enabled=true;this.auto_rotate(this.prev_frame_ts);return true}return null}},{key:"stop_auto_rotate",value:function t(){if(this.__auto_rotate_enabled){this.__auto_rotate_enabled=false;return false}return null}},{key:"toggle_auto_rotate",value:function t(){if(this.__auto_rotate_enabled){return this.stop_auto_rotate()}else{return this.start_auto_rotate()}}},{key:"auto_rotate",value:function t(e){var a=this;var n=this.camera.components.rotation.data;var i=n.x;var s=n.y;var r=n.z;this.camera.setAttribute("rotation",{x:i,y:Math.abs(s)>360?0:s+this.px_per_frame(e),z:r});if(this.__auto_rotate_enabled){requestAnimationFrame(function(t){return a.auto_rotate(t)})}}},{key:"px_per_frame",value:function t(e){var a=1e3/(e-this.prev_frame_ts);var n=0;this.prev_frame_ts=e;if(this.settings.rotation_time){n=360/(a*this.settings.rotation_time)}else{n=1/a*this.settings.auto_rotate_speed}return this.settings.auto_rotate_direction=="left"?n:n*=-1}},{key:"listen",value:function t(e){for(var a=arguments.length,n=Array(a>1?a-1:0),i=1;i<a;i++){n[i-1]=arguments[i]}e.addEventListener.apply(e,n)}}],[{key:"settings",value:function t(e){Object.assign(s,e);if(s.cubemap_folder_template){s.cubemap_folder_template.split("/").forEach(function(t){if(t&&t[0]===":"){i.push(t.substr(1))}})}}},{key:"new",value:function t(){for(var e=arguments.length,a=Array(e),n=0;n<e;n++){a[n]=arguments[n]}return new(Function.prototype.bind.apply(r,[null].concat(a)))}}]);return r}()}();